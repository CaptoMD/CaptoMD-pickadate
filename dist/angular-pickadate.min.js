!function(e){"use strict";function t(e,t){for(var a=t.parentNode;null!==a;){if(a===e)return!0;a=a.parentNode}return!1}function a(t,a){var n=[];return e.forEach(t,function(t){n.push(e.isFunction(a)?a(t):t[a])}),n}var n=[].indexOf||function(e){for(var t=0,a=this.length;a>t;t++)if(t in this&&this[t]===e)return t;return-1};e.module("pickadate",[]).provider("pickadateI18n",function(){var e={prev:"prev",next:"next"};this.translations={},this.$get=function(){var t=this.translations;return{t:function(a){return t[a]||e[a]}}}}).factory("pickadateUtils",["$locale","dateFilter",function(t,a){function n(e){switch(e){case"dd":return"day";case"MM":return"month";case"yyyy":return"year"}}return function(i){return i=i||"yyyy-MM-dd",{parseDate:function(t){if(t){if(e.isDate(t))return new Date(t);var a="(dd|MM|yyyy)",r=i.match(/[-|/]/)[0],s=t.split(r),c=new RegExp([a,a,a].join(r)),l=i.match(c),o={};if(l.shift(),e.forEach(l,function(e,t){o[n(e)]=parseInt(s[t],10)}),!(isNaN(o.year)||isNaN(o.month)||isNaN(o.day)))return new Date(o.year,o.month-1,o.day,3)}},buildDateObject:function(t){var n=e.copy(t),r=a(n,i);return{date:n,formattedDate:r,today:r===a(new Date,i)}},buildDates:function(e,t){var a=[],n=new Date(e.getFullYear(),e.getMonth()+1,0,3);for(t=t||{},e=new Date(e);e.getDay()!==t.weekStartsOn;)e.setDate(e.getDate()-1);for(var i=0;42>i&&!(t.noExtraRows&&e.getDay()===t.weekStartsOn&&e>n);i++)a.push(this.buildDateObject(e)),e.setDate(e.getDate()+1);return a},buildDayNames:function(e){var a=t.DATETIME_FORMATS.SHORTDAY;if(e){a=a.slice(0);for(var n=0;e>n;n++)a.push(a.shift())}return a},getMonthOffset:function(e,t){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}}}}]).directive("pickadate",["$locale","$sce","$compile","$document","$window","pickadateUtils","pickadateI18n","filterFilter",function(i,r,s,c,l,o,d,u){var f='<div class="pickadate" ng-show="displayPicker" ng-style="styles"><div class="pickadate-header"><div class="pickadate-controls"><a href="" class="pickadate-prev" ng-click="changeMonth(-1)" ng-show="allowPrevMonth">'+r.trustAsHtml(d.t("prev"))+'</a><a href="" class="pickadate-next" ng-click="changeMonth(1)" ng-show="allowNextMonth">'+r.trustAsHtml(d.t("next"))+'</a></div><h3 class="pickadate-centered-heading">{{currentDate | date:"MMMM yyyy"}}</h3></div><div class="pickadate-body"><div class="pickadate-main"><ul class="pickadate-cell"><li class="pickadate-head" ng-repeat="dayName in dayNames">{{dayName}}</li></ul><ul class="pickadate-cell"><li ng-repeat="dateObj in dates" ng-click="setDate(dateObj)" ng-class="classesFor(dateObj)">{{dateObj.date | date:"d"}}</li></ul></div></div></div>';return{require:"ngModel",scope:{defaultDate:"=",minDate:"=",maxDate:"=",disabledDates:"=",weekStartsOn:"="},link:function(i,r,d,p){function h(){var t=new Date(i.currentDate.getFullYear(),i.currentDate.getMonth(),1,3),a=t.getMonth()+1,n=[],r=E.buildDates(t,{weekStartsOn:O,noExtraRows:w}),s=new Date(t);s.setMonth(a),i.allowPrevMonth=!v||t>v,i.allowNextMonth=!m||m>=s,i.dayNames=E.buildDayNames(O),e.forEach(r,function(e){y(e),e.classNames=[e.enabled?"pickadate-enabled":"pickadate-disabled"],e.today&&e.classNames.push("pickadate-today"),e.disabled&&e.classNames.push("pickadate-unavailable"),n.push(e)}),i.dates=n}function D(e,t){t=t||{},p.$setViewValue(k?a(e,"formattedDate"):e[0]&&e[0].formattedDate),t.skipRenderInput||r.val(p.$viewValue)}function y(e){var t=E.getMonthOffset(e.date,i.currentDate);return e.disabled=n.call(i.disabledDates||[],e.formattedDate)>=0,e.outOfRange=e.date<v||e.date>m||-1===t&&!b||1===t&&!M,e.enabled=!(e.disabled||e.outOfRange),e}function g(e,t){var a=n.call(t,e);return-1===a?t.push(e):t.splice(a,1),t}var v,m,w=d.hasOwnProperty("noExtraRows"),k=d.hasOwnProperty("multiple"),M=/^(next|both)$/.test(d.selectOtherMonths),b=/^(previous|both)$/.test(d.selectOtherMonths),O=i.weekStartsOn,$=[],N=r[0]instanceof HTMLInputElement,x=s(f)(i),R=(d.format||"yyyy-MM-dd").replace(/m/g,"M"),E=o(R);i.displayPicker=!N,(!e.isNumber(O)||0>O||O>6)&&(O=0),i.setDate=function(e){var t=E.getMonthOffset(e.date,i.currentDate);e.enabled&&($=k?g(e,$):[e],D($),0!==t&&i.changeMonth(t),i.displayPicker=!N)};var F=p.$render=function(t){t=t||{},e.isArray(p.$viewValue)?$=p.$viewValue:p.$viewValue&&($=[p.$viewValue]),i.currentDate=E.parseDate(i.defaultDate||$[0])||new Date,$=a($,function(e){return y(E.buildDateObject(E.parseDate(e)))}),$=u($,{enabled:!0}),D($,t),h()};if(i.classesFor=function(e){var t=a($,"formattedDate"),i=n.call(t,e.formattedDate)>=0?"pickadate-active":null;return e.classNames.concat(i)},i.changeMonth=function(e){i.currentDate.setDate(1),i.currentDate.setMonth(i.currentDate.getMonth()+e),h()},i.$watch(function(){return e.toJson([i.minDate,i.maxDate,i.disabledDates])},function(){v=E.parseDate(i.minDate)||new Date(0),m=E.parseDate(i.maxDate)||new Date(99999999999999),F()}),N){var V=function(e){i.displayPicker=e,i.$apply()};r.on("focus",function(){var e=void 0!==l.pageXOffset,t="CSS1Compat"===(c.compatMode||""),a=e?l.pageXOffset:t?c.documentElement.scrollLeft:c.body.scrollLeft,n=e?l.pageYOffset:t?c.documentElement.scrollTop:c.body.scrollTop,s=l.innerWidth||c.documentElement.clientWidth||c.body.clientWidth;i.styles={top:n+r[0].getBoundingClientRect().bottom+"px"},s-r[0].getBoundingClientRect().left>=300?i.styles.left=a+r[0].getBoundingClientRect().left+"px":i.styles.right=s-r[0].getBoundingClientRect().right-a+"px",V(!0)}),r.on("keydown",function(e){n.call([9,13,27],e.keyCode)>=0&&V(!1)}),i.$watch(function(){return p.$viewValue},function(e){var t=E.parseDate(e);t&&F({skipRenderInput:!0}),p.$setValidity("date",!!t)}),c.on("click",function(e){t(x[0],e.target)||e.target===r[0]||V(!1)}),i.$$postDigest(function(){d.value&&(p.$viewValue=d.value,F())}),r.after(x.addClass("pickadate-modal"))}else r.append(x)}}}])}(window.angular);